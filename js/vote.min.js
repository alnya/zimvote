if(document.getElementsByTagName("html")[0].className.indexOf("hasJS")==-1){document.getElementsByTagName("html")[0].className+=" hasJS"}if(!sokwanele){var sokwanele={}}var tableTemplate="<table class='resultstable'><thead><tr><th colspan='2' class='name'>Constituency</th><th>% won</th><th>% turnout</th></tr></thead>"+"<tbody>{{#items}}<tr><td class='partytag' style='background:{{colour}}'></td><td class='name'><a href='#' turnout='{{turnout}}' cid='{{id}}'>{{name}}</a></td><td class='val'>{{won}}</td><td class='val'>{{turnout}}</td></tr>{{/items}}</tbody></table>";var marginTableTemplate="<table class='resultstable'><thead><tr><th colspan='2' class='name'>Constituency</th><th>% margin</th><th>% turnout</th></tr></thead>"+"<tbody>{{#items}}<tr><td class='partytag' style='background:{{colour}}'></td><td class='name'><a href='#' turnout='{{turnout}}' cid='{{id}}'>{{name}}</a></td><td class='val'>{{won}}</td><td class='val'>{{turnout}}</td></tr>{{/items}}</tbody></table>";var PRTableTemplate="{{#provinces}}<h3>{{name}}</h3><table class='resultstable'><thead><tr><th colspan='2' class='name'>Party</th><th>seats</th><th>% turnout</th></tr></thead>"+"<tbody>{{#items}}<tr><td class='partytag' style='background:{{colour}}'></td><td class='name'><a href='#' turnout='{{turnout}}' cid='{{id}}'>{{name}}</a></td><td class='val'>{{votes}}</td><td class='val'>{{turnout}}</td></tr>{{/items}}</tbody></table>{{/provinces}}";var tooltipTemplate="<div class='tooltipview'><h3>{{name}}</h3><table class='resultstable'><thead><tr>"+"<th colspan='2' class='name'>Party</th><th>{{voteheading}}</th></tr></thead><tbody>{{#items}}<tr>"+"<td class='partytag' style='background:{{colour}}'></td><td class='name'>{{name}}</td>"+"<td class='val'>{{votes}}</td></tr>{{/items}}</tbody></table></div>";var tooltipBG="<div class='tooltipview'><h3>{{name}}</h3><h4>{{margin}}% margin</h4><table class='resultstable'><thead><tr>"+"<th colspan='2' class='name'>Party</th><th>percent</th></tr></thead><tbody>{{#items}}<tr>"+"<td class='partytag' style='background:{{colour}}'></td><td class='name'>{{name}}</td>"+"<td class='val'>{{votes}}</td></tr>{{/items}}</tbody></table></div>";var detailTemplate="<div id='detailchart'></div><img id='detailswing'/><h3><a href='http://www.sokwanele.com/zimbabwe-elections/constituency/{{name}}'>{{name}}</a></h3><h4>Turnout: {{turnout}}%</h4>"+"<table class='detailtable'><tbody>{{#items}}"+"<tr><td class='partytag' style='background:{{colour}}'></td><td>{{name}}</td><td>{{party}}</td>"+"<td>{{votes}}</td><td>{{percent}}</td></tr>{{/items}}</tbody></table>";sokwanele.vote=function(){var e=this;this.map=null;this.debugErrors=false;this.activeRace="house";this.activeYear="2013";this.polygons=new Array;this.defaultColor="#999999";this.constituencies=new Array;this.overPolygon=false;this.init=function(){e.debug("init");google.load("visualization","1",{packages:["corechart"]});google.maps.event.addDomListener(window,"load",e.initMap);google.setOnLoadCallback(e.drawChart);$(document).ready(function(){e.ready()})};this.ready=function(){e.debug("jquery ready");e.initTabs();$("#helpbutton").click(function(e){$("#helpoverlay").show()});$("#closebutton").click(function(e){$("#helpoverlay").hide()})};this.commaSeparateNumber=function(e){while(/(\d+)(\d{3})/.test(e.toString())){e=e.toString().replace(/(\d+)(\d{3})/,"$1"+","+"$2")}return e};this.initTabs=function(){$("#Tabs li a").click(function(t){t.preventDefault();e.setActiveTab(this);e.activeRace=$(this).attr("href").replace("#","");e.addConstituencies();e.drawChart();$("#detail").html("");$("#marginkey").css("display",e.activeRace=="battleground"?"block":"none")});$("#StagePicker li a").click(function(t){t.preventDefault();e.setActiveTab(this);$("#map").animate({left:$(this).attr("href")=="#map"?"0px":"-847px"});$("#table").animate({left:$(this).attr("href")=="#map"?"847px":"0px"});$("#stage").css("overflow-y",$(this).attr("href")=="#map"?"hidden":"auto")})};this.drawChart=function(){$.ajax({type:"GET",url:"api.php/results/party/"+e.activeRace+"/"+e.activeYear,dataType:"json",success:function(t){if(t.data){var n=["Year"];var r=[];var i=[e.activeRace=="president"?"Votes":"Seats"];$.each(t.data,function(t,s){if(s.percent==null){s.percent=0}var o=s.name;if(e.activeRace=="president"){o=s.name+" ("+s.percent+"%)"}if(e.activeRace=="house"&&e.activeYear=="2013"||e.isPR()){o=s.name+" ("+s.votes+")"}n.push(o);i.push(parseInt(s.votes));if(s.colour){r.push(s.colour)}else{r.push("#333")}});var s=google.visualization.arrayToDataTable([n,i]);var o={animation:{duration:100},width:976,height:100,colors:r,legend:{position:"top"}};var u=new google.visualization.BarChart(document.getElementById("ResultsChart"));u.draw(s,o)}},error:function(t,n,r){e.debug("api error: "+n)}})};this.setActiveTab=function(t){e.debug("tab clicked");$(t).parent().parent().find("a").removeClass("active");$(t).addClass("active")};this.initMap=function(){e.debug("google maps ready");var t=[];var n=new google.maps.StyledMapType(t,{name:"2008"});var r=new google.maps.StyledMapType(t,{name:"2013"});e.mapCenter=new google.maps.LatLng(-18.895893,28.894043);e.map=new google.maps.Map(document.getElementById("map-canvas"),{zoom:7,center:e.mapCenter,minZoom:7,maxZoom:11,streetViewControl:false,mapTypeControlOptions:{mapTypeIds:["2008","2013"]},mapTypeId:e.activeYear});e.map.mapTypes.set("2008",n);e.map.mapTypes.set("2013",r);google.maps.event.addListener(e.map,"maptypeid_changed",function(){e.activeYear=e.map.getMapTypeId();$("h1").html("Zimbabwe Election "+e.activeYear);$("#tabhouselist").css("display",e.activeYear=="2013"?"block":"none");$("#tabbattleground a").text(e.activeYear=="2013"?"margin":"battleground");e.addConstituencies();e.drawChart()});$("#tooltip").poshytip({followCursor:true,slide:false,className:"tip-twitter",showTimeout:1,alignTo:"cursor",keepInViewport:true});$("#map-canvas").mousemove(function(e){$("#tooltip").poshytip("mousemove",e)});e.addConstituencies()};this.addConstituencies=function(){$("#loading").show();e.constituencies=new Array;for(var t=0;t<e.polygons.length;t++){e.polygons[t].setMap(null)}e.polygons=new Array;$.ajax({type:"GET",url:"api.php/constituencies/"+e.activeRace+"/"+e.activeYear,dataType:"json",success:function(t){e.populateTable(t);for(var n=0;n<t.data.length;n++){e.addPolygon(t.data[n])}$("#loading").hide()},error:function(t,n,r){e.debug("api error: "+n)}})};this.populateTable=function(t){var n=t.data.length/3;if(e.isPR()){var r=[];$.ajax({type:"GET",url:"api.php/results/pr/"+e.activeRace+"/"+e.activeYear,dataType:"json",success:function(e){var t="";var i=[];for(var s=0;s<e.data.length;s++){var o=e.data[s];if(o.province!=t){t=o.province;i=[];r.push({name:t,items:i})}i.push(o)}var u={provinces:r.slice(0,n)};var a={provinces:r.slice(n,n*2)};var f={provinces:r.slice(n*2,n*3)};$("#tablecolumn1").html(Mustache.render(PRTableTemplate,u));$("#tablecolumn2").html(Mustache.render(PRTableTemplate,a));$("#tablecolumn3").html(Mustache.render(PRTableTemplate,f))}})}else{var i={items:t.data.slice(0,n)};var s={items:t.data.slice(n,n*2)};var o={items:t.data.slice(n*2,n*3)};var u=e.activeRace=="battleground"?marginTableTemplate:tableTemplate;$("#tablecolumn1").html(Mustache.render(u,i));$("#tablecolumn2").html(Mustache.render(u,s));$("#tablecolumn3").html(Mustache.render(u,o));$(".resultstable .name a").click(function(t){e.getConstituencyResults($(this).attr("cid"),$(this).html(),$(this).attr("turnout"));t.preventDefault()})}};this.addPolygon=function(t){var n=$.parseXML(t.geometry);var r=$(n).find("coordinates");var i=r.text().split(",0.0 ");var s=new Array;var o=[];for(var u=0;u<i.length;u++){s=i[u].split(",");o.push(new google.maps.LatLng(parseFloat(s[1]),parseFloat(s[0])))}var a=t.colour!=""&&t.colour!=null?t.colour:e.defaultColor;var f=new google.maps.Polygon({paths:o,strokeColor:"#fff",strokeOpacity:1,strokeWeight:1,fillColor:a,fillOpacity:1,map:e.map});google.maps.event.addListener(f,"click",function(n){e.getConstituencyResults(t.id,t.name,t.turnout)});google.maps.event.addListener(f,"mouseover",function(n){$("#tooltip").poshytip("update","Loading...");e.overPolygon=true;e.getConstituencyResultsSummary(n,t.name,t.id,t.margin)});google.maps.event.addListener(f,"mouseout",function(){e.overPolygon=false;$("#tooltip").poshytip("hide")});e.polygons.push(f)};this.getConstituencyResults=function(t,n,r,i){$.ajax({type:"GET",url:"api.php/results/"+e.activeRace+"/"+e.activeYear+"/"+t,dataType:"json",success:function(s){var o={name:n,turnout:r,voters:i,items:s.data};$("#detail").html(Mustache.render(detailTemplate,o));var u=[["Candidate","Votes"]];var a=[];$.each(s.data,function(e,t){u.push([t.name,parseInt(t.votes)]);a.push(t.colour)});var f={width:200,colors:a,legend:{position:"none"}};var l=google.visualization.arrayToDataTable(u);(new google.visualization.PieChart(document.getElementById("detailchart"))).draw(l,f);if(e.activeYear=="2013"&&(e.activeRace=="president"||e.activeRace=="house")){$.ajax({type:"GET",url:"api.php/swing/"+e.activeRace+"/"+t,dataType:"json",success:function(e){if(e.data.swing!=null){var t=e.data.fromcolor.replace("#","");var n=e.data.tocolour.replace("#","");var r=50+parseFloat(e.data.swing);$("#detailswing").attr("src","https://chart.googleapis.com/chart?chs=200x150&cht=gom&chd=t:"+r+"&chco="+t+","+n+"&chl="+e.data.swing+"% swing")}}})}},error:function(t,n,r){e.debug("api error: "+n)}})};this.getConstituencyResultsSummary=function(t,n,r,i){if(r in e.constituencies){if(e.overPolygon){$("#tooltip").poshytip("update",e.constituencies[r]);$("#tooltip").poshytip("mouseenter",t)}}else{$.ajax({type:"GET",url:"api.php/resultssummary/"+e.activeRace+"/"+e.activeYear+"/"+r,dataType:"json",success:function(s){var o=e.isPR()?"seats":"votes";var u={name:n,margin:i,voteheading:o,items:s.data};var a=i!=null?tooltipBG:tooltipTemplate;e.constituencies[r]=Mustache.render(a,u);if(e.overPolygon){$("#tooltip").poshytip("update",e.constituencies[r]);$("#tooltip").poshytip("mouseenter",t)}},error:function(t,n,r){e.debug("api error: "+n)}})}};this.isPR=function(){return e.activeRace=="houselist"||e.activeRace=="senate"&&e.activeYear=="2013"};this.debug=function(e){if(this.debugErrors==true){if(typeof console!="undefined"&&typeof console.log=="function"){console.log(e)}else{alert(e)}}};this.init()};var votermap=new sokwanele.vote